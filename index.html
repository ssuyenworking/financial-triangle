<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç†è²¡é‡‘ä¸‰è§’ï½œè²¡å‹™çµæ§‹æª¢è¦–</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- html2pdf (å‰ç«¯ç›´æ¥è¼¸å‡º PDF) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      background:#f7f8fa;
      margin:0;
      padding:16px;
    }
    h1{ text-align:center; margin-bottom:6px; }
    .subtitle{ text-align:center; color:#555; margin-top:0; }
    .desc{ text-align:center; color:#888; font-size:14px; margin: 8px 0 12px; }

    .card{
      background:#fff;
      border-radius:12px;
      padding:16px;
      margin-bottom:16px;
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }

    label{ display:block; margin-top:12px; font-weight:700; }
    .sub-label{ font-weight:500; margin-top:8px; color:#333; }

    input, select{
      width:100%;
      padding:10px;
      margin-top:6px;
      font-size:16px;
      box-sizing:border-box;
    }

    button{
      width:100%;
      padding:14px;
      font-size:18px;
      border:none;
      border-radius:8px;
      margin-top:12px;
      cursor:pointer;
    }
    .primary{ background:#1f6fff; color:#fff; }
    .cta{ background:#e53935; color:#fff; }
    .secondary{ background:#4caf50; color:#fff; }
    .reset{ background:#9e9e9e; color:#fff; }

    .switch-group{ display:flex; gap:8px; margin-top:8px; }
    .switch-btn{
      flex:1;
      padding:12px;
      font-size:16px;
      border-radius:8px;
      border:1px solid #ccc;
      background:#f2f2f2;
      cursor:pointer;
    }
    .switch-btn.active{
      background:#1f6fff;
      color:#fff;
      border-color:#1f6fff;
    }

    .result{ font-size:18px; line-height:1.6; margin-top:12px; }

    .calc-box{
      margin-top:12px;
      padding:12px;
      border-radius:10px;
      background:#f2f6ff;
    }
    .calc-title{ font-weight:800; margin-bottom:6px; }
    .calc-row{ display:flex; justify-content:space-between; gap:12px; }
    .calc-row span{ font-weight:800; }

    /* Modal */
    .modal{
      display:none;
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.5);
      z-index:999;
    }
    .modal-content{
      background:#fff;
      margin:10% auto;
      padding:18px;
      border-radius:12px;
      width:92%;
      max-width:460px;
    }
    .option-btn{
      width:100%;
      padding:12px;
      border-radius:8px;
      border:1px solid #ccc;
      background:#f7f7f7;
      margin-top:8px;
      font-size:16px;
      cursor:pointer;
    }

    /* PDF æ’ç‰ˆå‹å–„ï¼ˆreportå€å¡Šï¼‰ */
    #reportHeader{
      margin-bottom:10px;
      padding-bottom:10px;
      border-bottom:1px solid #eee;
    }
    .report-title{ font-size:20px; font-weight:900; margin:0; }
    .report-sub{ color:#555; margin:4px 0 0; }
    .report-meta{ color:#777; font-size:13px; margin-top:8px; line-height:1.5; }
    .small-note{ font-size:13px; color:#777; margin-top:12px; }
  </style>
</head>

<body>

  <h1>ç†è²¡é‡‘ä¸‰è§’</h1>
  <div class="subtitle">å¿«é€Ÿçœ‹æ‡‚ä½ çš„è²¡å‹™çµæ§‹</div>
  <div class="desc">ä¸æ˜¯æŠ•è³‡æ¨¡å‹ï¼Œåªç”¨ä¾†æª¢è¦–çµæ§‹æ˜¯å¦å®‰å…¨ï¼ˆç¾å ´å¡«ã€ç¾å ´è§£è®€ã€ç¾å ´æˆäº¤ï¼‰</div>

  <!-- è¼¸å…¥å€ -->
  <div class="card">
    <label>ä½ ç›®å‰çš„ç‹€æ…‹</label>
    <div class="switch-group">
      <button id="btnStudent" class="switch-btn active" type="button">ğŸ“ å­¸ç”Ÿ / å‰›å‡ºç¤¾æœƒ</button>
      <button id="btnWorker" class="switch-btn" type="button">ğŸ’¼ ä¸€èˆ¬ä¸Šç­æ—</button>
    </div>

    <label>å®¢æˆ¶ä»£ç¨±ï¼ˆé¸å¡«ï¼Œä¸å¡«ä¹Ÿå¯è¼¸å‡ºPDFï¼‰</label>
    <input type="text" id="clientAlias" placeholder="ä¾‹å¦‚ï¼šç‹å…ˆç”Ÿ / å°æ½” / Aå®¢ï¼ˆé¿å…å¡«èº«åˆ†è­‰ã€é›»è©±ç­‰å€‹è³‡ï¼‰" />

    <label>æ”¶å…¥è¼¸å…¥æ–¹å¼</label>
    <select id="incomeType">
      <option value="month">æœˆæ”¶å…¥</option>
      <option value="year">å¹´æ”¶å…¥</option>
    </select>

    <label id="incomeLabel">æœˆæ”¶å…¥</label>
    <input type="number" id="incomeAmount" placeholder="ä¾‹å¦‚ï¼š45000" inputmode="numeric"/>

    <label>æ—¥å¸¸é–‹éŠ·ï¼ˆæ¯æœˆï¼Œè«‹é€é …å¡«å¯«ï¼‰</label>

    <div class="sub-label">æˆ¿ç§Ÿ/æˆ¿è²¸</div>
    <input type="number" id="exp_housing" placeholder="0" inputmode="numeric"/>

    <div class="sub-label">æ°´é›»ç“¦æ–¯/ç¶²è·¯æ‰‹æ©Ÿ</div>
    <input type="number" id="exp_utilities" placeholder="0" inputmode="numeric"/>

    <div class="sub-label">é¤é£²ï¼ˆå¤–é£Ÿ/è²·èœï¼‰</div>
    <input type="number" id="exp_food" placeholder="0" inputmode="numeric"/>

    <div class="sub-label">äº¤é€šï¼ˆé€šå‹¤/æ²¹éŒ¢/åœè»Šï¼‰</div>
    <input type="number" id="exp_transport" placeholder="0" inputmode="numeric"/>

    <div class="sub-label">æ•™è‚²/è‚²å…’ï¼ˆå­¸è²»/æ‰è—/ä¿æ¯ï¼‰</div>
    <input type="number" id="exp_kids" placeholder="0" inputmode="numeric"/>

    <div class="sub-label">ä¿è²»ï¼ˆç¾æœ‰ä¿å–®æ¯æœˆä¿è²»ï¼‰</div>
    <input type="number" id="exp_insurance" placeholder="0" inputmode="numeric"/>

    <div class="sub-label">å¨›æ¨‚/è³¼ç‰©/ç¤¾äº¤</div>
    <input type="number" id="exp_lifestyle" placeholder="0" inputmode="numeric"/>

    <div class="sub-label">å…¶ä»–å›ºå®šæ”¯å‡º</div>
    <input type="number" id="exp_other" placeholder="0" inputmode="numeric"/>

    <div class="calc-box">
      <div class="calc-title">ç³»çµ±è¨ˆç®—</div>
      <div class="calc-row">
        <div>æ¯æœˆæ—¥å¸¸é–‹éŠ·åˆè¨ˆ</div>
        <div><span id="expenseTotal">0</span></div>
      </div>
      <div class="calc-row" style="margin-top:6px;">
        <div>å¯æ”¯é…æ‰€å¾—ï¼ˆæœˆå‰©é¤˜ï¼‰</div>
        <div><span id="remainingDisplay">0</span></div>
      </div>
    </div>

    <label>æ˜¯å¦æœ‰å„²è“„ï¼ˆå‚™ç”¨é‡‘ï¼‰</label>
    <select id="saving">
      <option value="none">æ²’æœ‰</option>
      <option value="some">æœ‰ä¸€é»</option>
      <option value="stable">å¯æ”¯æ’ä¸€æ®µæ™‚é–“</option>
    </select>

    <label>æ˜¯å¦æœ‰ 3â€“5 å¹´å…§çš„é‡è¦ç›®æ¨™ï¼ˆå¤¢æƒ³ï¼‰</label>
    <select id="goal">
      <option value="no">æ²’æœ‰ç‰¹åˆ¥æƒ³é</option>
      <option value="yes">æœ‰</option>
    </select>

    <label>æ˜¯å¦æœ‰æŠ•è³‡</label>
    <select id="investment">
      <option value="none">æ²’æœ‰</option>
      <option value="yes">æœ‰</option>
    </select>

    <label>ä¿éšªç‹€æ…‹</label>
    <select id="insurance">
      <option value="none">æ²’æœ‰</option>
      <option value="partial">ä¸å®Œæ•´</option>
      <option value="basic">åŸºæœ¬ä¿éšœå®Œæ•´</option>
    </select>

    <button class="primary" id="btnAnalyze" type="button">åˆ†ææˆ‘çš„ç†è²¡é‡‘ä¸‰è§’</button>
  </div>

  <!-- å ±å‘Šå€ï¼ˆPDFæœƒæŠ“é€™ä¸€å¡Šï¼‰ -->
  <div class="card" id="report">
    <div id="reportHeader">
      <p class="report-title">ç†è²¡é‡‘ä¸‰è§’ï½œè²¡å‹™çµæ§‹æª¢è¦–å ±å‘Š</p>
      <p class="report-sub">é¢¨éšª Ã— æº–å‚™ Ã— æˆé•·ï¼ˆåªçœ‹çµæ§‹ï¼Œä¸è«‡å ±é…¬ï¼‰</p>
      <div class="report-meta">
        <div>æ—¥æœŸï¼š<span id="reportDate"></span></div>
        <div>å®¢æˆ¶ä»£ç¨±ï¼š<span id="reportAlias">ï¼ˆæœªå¡«ï¼‰</span></div>
      </div>
    </div>

    <div class="calc-box" style="background:#f7f7ff;">
      <div class="calc-title">ç¾æ³æ‘˜è¦ï¼ˆæ¯æœˆï¼‰</div>
      <div class="calc-row">
        <div>æœˆæ”¶å…¥ï¼ˆæ›ç®—ï¼‰</div>
        <div><span id="reportIncome">0</span></div>
      </div>
      <div class="calc-row" style="margin-top:6px;">
        <div>æ—¥å¸¸é–‹éŠ·åˆè¨ˆ</div>
        <div><span id="reportExpense">0</span></div>
      </div>
      <div class="calc-row" style="margin-top:6px;">
        <div>å¯æ”¯é…æ‰€å¾—ï¼ˆæœˆå‰©é¤˜ï¼‰</div>
        <div><span id="reportRemaining">0</span></div>
      </div>
    </div>

    <canvas id="triangleChart"></canvas>
    <div id="summary" class="result"></div>
    <div id="focusResult" class="result"></div>

    <p class="small-note">
      æœ¬å ±å‘Šåƒ…ç‚ºè²¡å‹™çµæ§‹æª¢è¦–ï¼Œä¸æ¶‰åŠå•†å“åç¨±ã€é‡‘é¡ã€ä¿é¡ã€æŠ•è³‡å ±é…¬æˆ–ä»»ä½•æ”¶ç›Šæ‰¿è«¾ã€‚
      è‹¥éœ€é€²ä¸€æ­¥æ–¹æ¡ˆï¼Œå°‡ä»¥é¢è«‡ç¢ºèªéœ€æ±‚å¾Œå¦è¡Œèªªæ˜ã€‚
    </p>
  </div>

  <button class="cta" id="btnOpenModal" type="button">é–‹å§‹åŸºæœ¬ä¿éšœé…ç½®èªªæ˜</button>
  <button class="secondary" id="btnPDF" type="button">ä¸‹è¼‰æœ¬æ¬¡åˆ†æå ±å‘Šï¼ˆPDFï¼‰</button>
  <button class="reset" id="btnReset" type="button">é‡è¨­ï¼ä¸‹ä¸€ä½å®¢æˆ¶</button>

  <!-- æˆäº¤è©±è¡“å°å¡ Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <h3 style="margin:0 0 8px;">å¦‚æœåªèƒ½å…ˆé¡§å¥½ä¸€ä»¶äº‹ï¼Œä½ ç¾åœ¨æœ€åœ¨æ„å“ªä¸€å¡Šï¼Ÿ</h3>

      <button class="option-btn" type="button" data-focus="life">ç”Ÿæ´»ä¸ä¸­æ–·</button>
      <button class="option-btn" type="button" data-focus="family">ä¸æ‹–ç´¯å®¶äºº</button>
      <button class="option-btn" type="button" data-focus="future">æœªä¾†è¨ˆç•«ä¸è¢«æ‰“æ–·</button>

      <p id="talkCard" style="margin-top:12px; line-height:1.6;"></p>

      <button class="primary" id="btnCloseModal" type="button">äº†è§£ï¼Œé–‹å§‹èªªæ˜</button>
    </div>
  </div>

<script>
  // ===== ç‹€æ…‹ =====
  let chart = null;
  let userType = "student"; // student / worker
  let focusText = "";

  // ===== å·¥å…·å‡½æ•¸ =====
  function n(v){ return Number(v || 0); }
  function fmt(v){
    const num = Math.round(Number(v || 0));
    return num.toLocaleString("zh-Hant-TW");
  }

  function getMonthlyIncome(){
    const incomeTypeEl = document.getElementById("incomeType");
    const incomeAmountEl = document.getElementById("incomeAmount");
    const amount = n(incomeAmountEl.value);
    if (incomeTypeEl.value === "year") return amount / 12;
    return amount;
  }

  function getExpenseTotal(){
    const ids = [
      "exp_housing","exp_utilities","exp_food","exp_transport",
      "exp_kids","exp_insurance","exp_lifestyle","exp_other"
    ];
    return ids.reduce((sum, id) => sum + n(document.getElementById(id).value), 0);
  }

  function updateCashflowPreview(){
    const monthlyIncome = getMonthlyIncome();
    const expenseTotal = getExpenseTotal();
    const remaining = monthlyIncome - expenseTotal;

    document.getElementById("expenseTotal").innerText = fmt(expenseTotal);
    document.getElementById("remainingDisplay").innerText = fmt(remaining);

    // åŒæ­¥åˆ°å ±å‘Šå€ï¼ˆPDFä¹Ÿæœƒåƒåˆ°ï¼‰
    document.getElementById("reportIncome").innerText = fmt(monthlyIncome);
    document.getElementById("reportExpense").innerText = fmt(expenseTotal);
    document.getElementById("reportRemaining").innerText = fmt(remaining);

    // åŒæ­¥ä»£ç¨±
    const alias = (document.getElementById("clientAlias").value || "").trim();
    document.getElementById("reportAlias").innerText = alias ? alias : "ï¼ˆæœªå¡«ï¼‰";
  }

  function setUserType(type){
    userType = type;
    const btnStudent = document.getElementById("btnStudent");
    const btnWorker = document.getElementById("btnWorker");
    btnStudent.classList.remove("active");
    btnWorker.classList.remove("active");
    (type === "student" ? btnStudent : btnWorker).classList.add("active");
  }

  // ===== åˆ†æ =====
  function analyze(){
    // å…ˆç¢ºä¿é è¦½åŒæ­¥
    updateCashflowPreview();

    const savingEl = document.getElementById("saving");
    const goalEl = document.getElementById("goal");
    const investmentEl = document.getElementById("investment");
    const insuranceEl = document.getElementById("insurance");

    const remaining = getMonthlyIncome() - getExpenseTotal();

    // å®‰å…¨ Safety
    let safety = 1;
    if (insuranceEl.value === "partial") safety = 2;
    if (insuranceEl.value === "basic") safety = 3;

    // æº–å‚™ Preparation
    let preparation = 2;

    if (userType === "student") {
      // å­¸ç”Ÿï¼šåªçœ‹çŸ­æœŸå‚™ç”¨é‡‘ï¼ˆä¸è«‡é€€ä¼‘ã€ä¸è¦æ±‚é•·æœŸç›®æ¨™ï¼‰
      if (savingEl.value === "none") preparation = 1;
      if (savingEl.value === "stable") preparation = 3;
    } else {
      // ä¸Šç­æ—ï¼šçœ‹ç¾é‡‘æµï¼‹å„²è“„ï¼‹ç›®æ¨™
      if (remaining <= 0) preparation = 1;
      if (remaining > 0 && savingEl.value !== "none" && goalEl.value === "yes") preparation = 3;
    }

    // æˆé•· Growthï¼ˆä¸çµ¦å¼±ï¼‰
    let growth = investmentEl.value === "yes" ? 3 : 2;

    // ç•«åœ–
    if (chart) chart.destroy();
    chart = new Chart(document.getElementById("triangleChart"), {
      type: "radar",
      data: {
        labels: ["å®‰å…¨", "æº–å‚™", "æˆé•·"],
        datasets: [{
          data: [safety, preparation, growth],
          backgroundColor: "rgba(31,111,255,0.2)",
          borderColor: "#1f6fff",
          borderWidth: 2
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          r: { min: 0, max: 3, ticks: { display: false } }
        }
      }
    });

    // è§£è®€æ–‡å­—ï¼ˆæ›´è²¼è¿‘ä½ è¦çš„å•Ÿè’™ï¼‹æˆäº¤ï¼‰
    const summaryEl = document.getElementById("summary");

    if (safety === 1) {
      summaryEl.innerText = "ç›®å‰æœ€éœ€è¦å…ˆè™•ç†çš„ä¸æ˜¯æŠ•è³‡æˆ–å­˜å¾ˆå¤šï¼Œè€Œæ˜¯ç¢ºä¿ç™¼ç”Ÿç‹€æ³æ™‚ï¼Œç”Ÿæ´»èˆ‡æ”¶å…¥ä¸æœƒè¢«æ‰“æ–·ã€‚";
    } else if (userType === "student" && preparation === 1) {
      summaryEl.innerText = "ä½ ç¾åœ¨çš„é—œéµæ˜¯å…ˆæº–å‚™ä¸€é»ç”Ÿæ´»å‚™ç”¨é‡‘ï¼Œè®“è‡¨æ™‚éœ€è¦æ™‚ä¸æœƒæ…Œï¼›åŒæ™‚æŠŠåŸºæœ¬ä¿éšœé¡§å¥½ï¼Œé¿å…å½±éŸ¿å­¸æ¥­èˆ‡ç”Ÿæ´»ã€‚";
    } else if (userType === "worker" && preparation === 1) {
      summaryEl.innerText = "ç¾åœ¨çš„é—œéµæ˜¯è®“ç¾é‡‘æµæœ‰æ›´å……è£•çš„å¯é‹ç”¨ç©ºé–“ï¼Œä¸¦æŠŠåŸºæœ¬ä¿éšœè£œé½Šï¼Œé¿å…è²¬ä»»å¢åŠ æ™‚é¢¨éšªæ²’è·Ÿä¸Šã€‚";
    } else {
      summaryEl.innerText = "ä½ çš„è²¡å‹™çµæ§‹å·²æœ‰åŸºç¤ï¼Œå¯ä»¥ä¸€æ­¥ä¸€æ­¥ä¾†ï¼Œä¸éœ€è¦ä¸€æ¬¡å®Œæˆï¼›å…ˆé¡§å¥½æ ¸å¿ƒé¢¨éšªï¼Œå¾Œé¢å†è«‡æ›´é•·æœŸçš„å®‰æ’ã€‚";
    }
  }

  // ===== æˆäº¤è©±è¡“å°å¡ï¼ˆå®¢æˆ¶å¯é¸ï¼‰ =====
  function openModal(){
    document.getElementById("modal").style.display = "block";
  }
  function closeModal(){
    document.getElementById("modal").style.display = "none";
  }

  function selectFocus(type){
    // ä¾å­¸ç”Ÿ/ä¸Šç­æ—æ›èªæ°£
    if (userType === "student") {
      if (type === "life") focusText = "ä½ é¸æ“‡çš„æ˜¯ï¼šç”Ÿæ´»ä¸ä¸­æ–·ã€‚é‡é»æ˜¯é¿å…æ„å¤–æˆ–ç”Ÿç—…å½±éŸ¿å­¸æ¥­èˆ‡ç”Ÿæ´»ï¼Œå…ˆæŠŠåŸºæœ¬é¢¨éšªé¡§å¥½ã€‚";
      if (type === "family") focusText = "ä½ é¸æ“‡çš„æ˜¯ï¼šä¸æ‹–ç´¯å®¶äººã€‚å…ˆç”¨æœ€åŸºæœ¬ã€è² æ“”å¾—èµ·çš„æ–¹å¼æŠŠé¢¨éšªé¡§å¥½ï¼Œé¿å…å®¶äººæ‰¿æ“”å¤ªå¤šå£“åŠ›ã€‚";
      if (type === "future") focusText = "ä½ é¸æ“‡çš„æ˜¯ï¼šæœªä¾†è¨ˆç•«ä¸è¢«æ‰“æ–·ã€‚å…ˆæŠŠé¢¨éšªé¡§å¥½ï¼Œè®“å­¸æ¥­ã€å·¥ä½œèˆ‡æœªä¾†é¸æ“‡ä¸æœƒè¢«è¿«ä¸­æ–·ã€‚";
    } else {
      if (type === "life") focusText = "ä½ é¸æ“‡çš„æ˜¯ï¼šç”Ÿæ´»ä¸ä¸­æ–·ã€‚å…ˆç¢ºä¿æ”¶å…¥æˆ–é†«ç™‚ç‹€æ³ç™¼ç”Ÿæ™‚ï¼Œç”Ÿæ´»ä»èƒ½ç¶­æŒï¼Œä¸ç”¨ç«‹åˆ»è¢«è¿«åœä¸‹ä¾†ã€‚";
      if (type === "family") focusText = "ä½ é¸æ“‡çš„æ˜¯ï¼šä¸æ‹–ç´¯å®¶äººã€‚å…ˆæŠŠè²¬ä»»é¢¨éšªé¡§å¥½ï¼Œé¿å…å®¶äººæ‰¿æ“”éå¤šå£“åŠ›ï¼Œè®“ç…§é¡§æ›´æœ‰åº•æ°£ã€‚";
      if (type === "future") focusText = "ä½ é¸æ“‡çš„æ˜¯ï¼šæœªä¾†è¨ˆç•«ä¸è¢«æ‰“æ–·ã€‚å…ˆé¿å…ä¸€æ¬¡äº‹ä»¶æ‰“äº‚å¤šå¹´åŠªåŠ›ï¼Œè®“è¦åŠƒèƒ½æŒçºŒå¾€å‰ã€‚";
    }

    document.getElementById("talkCard").innerText = focusText;
    document.getElementById("focusResult").innerText = focusText;
  }

  // ===== PDF =====
  function todayString(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }

  function downloadPDF(){
    // æ›´æ–°å ±å‘Šé ­è³‡è¨Šï¼ˆæ—¥æœŸ/ä»£ç¨±/ç¾æ³æ‘˜è¦ï¼‰
    document.getElementById("reportDate").innerText = todayString();
    updateCashflowPreview();

    const alias = (document.getElementById("clientAlias").value || "").trim();
    const filenameBase = alias ? `ç†è²¡é‡‘ä¸‰è§’_çµæ§‹æª¢è¦–å ±å‘Š_${alias}` : "ç†è²¡é‡‘ä¸‰è§’_çµæ§‹æª¢è¦–å ±å‘Š";

    const opt = {
      margin: 0.8,
      filename: `${filenameBase}.pdf`,
      image: { type: "jpeg", quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: "cm", format: "a4", orientation: "portrait" }
    };

    html2pdf().set(opt).from(document.getElementById("report")).save();
  }

  // ===== é‡è¨­ =====
  function resetAll(){
    document.getElementById("clientAlias").value = "";
    document.getElementById("incomeType").value = "month";
    document.getElementById("incomeAmount").value = "";

    const expIds = [
      "exp_housing","exp_utilities","exp_food","exp_transport",
      "exp_kids","exp_insurance","exp_lifestyle","exp_other"
    ];
    expIds.forEach(id => document.getElementById(id).value = "");

    document.getElementById("saving").value = "none";
    document.getElementById("goal").value = "no";
    document.getElementById("investment").value = "none";
    document.getElementById("insurance").value = "none";

    document.getElementById("summary").innerText = "";
    document.getElementById("focusResult").innerText = "";
    document.getElementById("talkCard").innerText = "";
    focusText = "";

    if (chart) { chart.destroy(); chart = null; }

    setUserType("student");
    closeModal();

    // é‡ç½®æ”¶å…¥æ¨™ç±¤
    document.getElementById("incomeLabel").innerText = "æœˆæ”¶å…¥";

    updateCashflowPreview();
    document.getElementById("incomeAmount").focus();
  }

  // ===== äº‹ä»¶ç¶å®šï¼ˆDOMContentLoadedï¼‰ =====
  document.addEventListener("DOMContentLoaded", () => {
    // åˆå§‹æ—¥æœŸ
    document.getElementById("reportDate").innerText = todayString();

    // åˆ‡æ›æŒ‰éˆ•
    document.getElementById("btnStudent").addEventListener("click", () => setUserType("student"));
    document.getElementById("btnWorker").addEventListener("click", () => setUserType("worker"));

    // æ”¶å…¥æ¨™ç±¤åˆ‡æ›
    const incomeTypeEl = document.getElementById("incomeType");
    const incomeLabelEl = document.getElementById("incomeLabel");

    function syncIncomeLabel(){
      incomeLabelEl.innerText = incomeTypeEl.value === "year" ? "å¹´æ”¶å…¥" : "æœˆæ”¶å…¥";
      updateCashflowPreview();
    }
    incomeTypeEl.addEventListener("change", syncIncomeLabel);

    // å³æ™‚è¨ˆç®—ç¶å®š
    document.getElementById("incomeAmount").addEventListener("input", updateCashflowPreview);
    document.getElementById("clientAlias").addEventListener("input", updateCashflowPreview);

    const expIds = [
      "exp_housing","exp_utilities","exp_food","exp_transport",
      "exp_kids","exp_insurance","exp_lifestyle","exp_other"
    ];
    expIds.forEach(id => document.getElementById(id).addEventListener("input", updateCashflowPreview));

    // åˆ†æ / å°å¡ / PDF / é‡è¨­
    document.getElementById("btnAnalyze").addEventListener("click", analyze);
    document.getElementById("btnOpenModal").addEventListener("click", openModal);
    document.getElementById("btnCloseModal").addEventListener("click", closeModal);
    document.getElementById("btnPDF").addEventListener("click", downloadPDF);
    document.getElementById("btnReset").addEventListener("click", resetAll);

    // å°å¡ä¸‰é¸é …
    document.querySelectorAll(".option-btn").forEach(btn => {
      btn.addEventListener("click", () => selectFocus(btn.dataset.focus));
    });

    // åˆå§‹åŒ–è¨ˆç®—
    syncIncomeLabel();
    updateCashflowPreview();
  });
</script>

</body>
</html>
